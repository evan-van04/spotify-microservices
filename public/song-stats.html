<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Song Stats · TrackIQ</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header>
    <div class="nav-left">
      <a href="/" class="brand">Track <span>IQ</span></a>
    </div>
    <nav>
      <ul>
        <li><a href="/song-stats.html" class="active">Song Stats</a></li>
        <li><a href="/song-similarity.html">Song Similarity</a></li>
        <li><a href="/trend-analytics.html">Trend Analytics</a></li>
        <li><a href="/top-tracks.html">Top Tracks</a></li>
        <li><a href="/playlist-analyzer.html">Playlist Analyzer</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h1 class="page-title">Song Stats</h1>
    <p class="page-subtitle">
      “What is this one song like?” – Inspect high-level track stats from Spotify: artist, album,
      popularity, playtime, release year, and more.
    </p>

    <div class="card song-card">
      <form id="songStatsForm" class="song-stats-form">
        <label for="songQuery">Song name or keywords</label>
        <input
          id="songQuery"
          type="text"
          placeholder="e.g. Mr Brightside, The Killers"
          required
        />
        <button type="submit">Get Song Stats</button>
      </form>

      <div id="loading" style="display:none; margin-top: 1rem;">
        Loading…
      </div>

      <div id="error" style="display:none; margin-top: 1rem; color: #dc2626;">
      </div>

      <div id="result" class="song-result" style="display:none; margin-top: 1.5rem;">
        <div class="song-header">
            <img
                id="albumImage"
                src=""
                alt=""
                class="album-cover"
                style="display:none;"
            />
            <div class="song-meta">
                <h2 id="trackName" class="track-title"></h2>
                <p id="artistLine" class="subtext"></p>
            </div>
        </div>


        <div class="stats-grid" style="margin-top: 1rem;">
          <div class="stat-item">
            <span id="artistStat"></span>
          </div>
          <div class="stat-item">
            <span id="albumStat"></span>
          </div>
          <div class="stat-item">
            <span id="releaseYearStat"></span>
          </div>
          <div class="stat-item">
            <span id="durationStat"></span>
          </div>
          <div class="stat-item">
            <span id="popularityStat"></span>
          </div>
          <div class="stat-item">
            <span id="popularityTierStat"></span>
          </div>
          <div class="stat-item">
            <span id="explicitStat"></span>
          </div>
          <div class="stat-item">
            <span id="marketsStat"></span>
          </div>
          <div class="stat-item">
            <span id="trackIdStat"></span>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    TrackIQ · Song Stats
  </footer>

  <script>
    const form = document.getElementById('songStatsForm');
    const queryInput = document.getElementById('songQuery');
    const loadingEl = document.getElementById('loading');
    const errorEl = document.getElementById('error');
    const resultEl = document.getElementById('result');

    const trackNameEl = document.getElementById('trackName');
    const artistLineEl = document.getElementById('artistLine');
    const albumImageEl = document.getElementById('albumImage');

    // stat lines (all "Stat: X" style)
    const artistStatEl = document.getElementById('artistStat');
    const albumStatEl = document.getElementById('albumStat');
    const releaseYearStatEl = document.getElementById('releaseYearStat');
    const durationStatEl = document.getElementById('durationStat');
    const popularityStatEl = document.getElementById('popularityStat');
    const popularityTierStatEl = document.getElementById('popularityTierStat');
    const explicitStatEl = document.getElementById('explicitStat');
    const marketsStatEl = document.getElementById('marketsStat');
    const trackIdStatEl = document.getElementById('trackIdStat');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const q = queryInput.value.trim();
      if (!q) return;

      // reset UI
      errorEl.style.display = 'none';
      errorEl.textContent = '';
      resultEl.style.display = 'none';
      loadingEl.style.display = 'block';

      try {
        const res = await fetch(`/api/song-stats?q=${encodeURIComponent(q)}`);
        const data = await res.json();

        loadingEl.style.display = 'none';

        if (!res.ok) {
          errorEl.style.display = 'block';
          errorEl.textContent = data.error || 'Something went wrong.';
          return;
        }

        // Header info
        const trackName = data.trackName || 'Unknown track';
        const artistName = data.artistName || 'Unknown artist';
        const albumName = data.albumName || 'Unknown album';

        trackNameEl.textContent = trackName;
        artistLineEl.textContent = `By ${artistName}`;

        if (data.albumImage) {
          albumImageEl.src = data.albumImage;
          albumImageEl.alt = albumName || 'Album cover';
          albumImageEl.style.display = 'block';
        } else {
          albumImageEl.style.display = 'none';
        }

        // Build "Stat: X" lines
        const releaseYear = data.releaseYear || 'Unknown';
        const durationFormatted = data.durationFormatted || 'Unknown';
        const popularity = (data.popularity != null) ? `${data.popularity} / 100` : 'Unknown';
        const popularityTier = data.popularityTier || 'Popularity tier: Unknown';
        const explicitText = data.explicit ? 'Yes' : 'No';
        const marketsCount = (data.marketsCount != null)
          ? `${data.marketsCount} markets`
          : 'Unknown';

        artistStatEl.textContent = `Artist: ${artistName}`;
        albumStatEl.textContent = `Album: ${albumName}`;
        releaseYearStatEl.textContent = `Release Year: ${releaseYear}`;
        durationStatEl.textContent = `Duration: ${durationFormatted}`;
        popularityStatEl.textContent = `Popularity: ${popularity}`;
        popularityTierStatEl.textContent = popularityTier; // already "Popularity tier: X"
        explicitStatEl.textContent = `Explicit: ${explicitText}`;
        marketsStatEl.textContent = `Available Markets: ${marketsCount}`;
        trackIdStatEl.textContent = `Spotify Track ID: ${data.trackId || 'Unknown'}`;

        resultEl.style.display = 'block';
      } catch (err) {
        loadingEl.style.display = 'none';
        errorEl.style.display = 'block';
        errorEl.textContent = 'Request failed: ' + err.message;
      }
    });
  </script>
</body>
</html>
